\section{Previous work}

\subsection{\commonlisp{} the Language, second edition}

\subsubsection{Environment query}

Section 8.5 of ``Common Lisp, the Language, second edition'' describes
a set of functions for obtaining information from environment
objects and some other operators related to environments.

For environment query, it defines three functions.  We describe them
briefly here.

The function \texttt{variable-information} takes a symbol and an
optional environment object as arguments.  It returns three values.
The first value indicates the type of the binding (lexical variable,
special variable, symbol macro, constant variable) or \texttt{nil} if
there is no binding or definition in the environment for that symbol
The second value is a Boolean, indicating whether the binding is local
or global.  The third argument is an association list containing
declarations that apply to the binding.

The function \texttt{function-information} takes a function name and
an optional environment as arguments.  Again, three values are
returned.  The first value indicates the type of the binding
(function, macro, special operator\footnote{The term used in the book
  is \emph{special form}, but the terminology has been improved since
  then}) or \texttt{nil} if there is no binding or definition in the
environment for that function name.  As before, the second value
indicates whether the definition is local or global, and the third
value is an association list of declarations that apply.

The function \texttt{declaration-information} takes a
\emph{declaration name} and an optional environment as arguments.  The
declaration name can be the symbol \texttt{optimize}, the symbol
\texttt{declaration}, or some implementation-defined declaration
names.  It returns a single value that contains information related to
the corresponding declaration name.

To begin with, it is clear that this set of functions is insufficient
to process all \commonlisp{} code, because no mechanism is described
for querying the environment for information related to \emph{blocks}
and \emph{go tags}.  Functions for this purpose are provided as
extensions by Allegro Common Lisp as described in
\refSec{sec-previous-allegro}.

\subsubsection{Environment augmentation}

For augmenting an environment, i.e., creating a new, augmented,
environment from an existing one, the same section describes the
function \texttt{augment-environment}.

\subsection{\sbcl{}}

\subsubsection{Native}

\sbcl{} defines a structure class named \texttt{lexenv}.  Instances of
this class are passed as the \texttt{\&environment} argument to macro
expanders and other functions that take lexical environment objects as
arguments.

This structure class contains several slots, and in particular:
\begin{itemize}
\item An association list of information about defined functions.
  The name of the function is used as a key.
\item A association list of information about defined variables.
  The name of the variable is used as a key.
\item An association list of information about blocks,
  The name of the block is used as a key.
\item An association list of information about \texttt{tagbody} tags.
  The name of the tag is used as a key.
\end{itemize}

\subsubsection{CLtL2}

The distribution of \sbcl{} contain a contribution that supplies some
of the funtionality described in the book CLtL2 but that was not
included in the \commonlisp{} standard.  Part of this contribution is
an implementation of the environment protocol of CLtL2.

\subsection{CCL}

\subsection{CMUCL}

\subsection{ECL}

\subsection{Allegro}
\label{sec-previous-allegro}

\subsubsection{Native environments}

\subsubsection{Support for CLtL2 protocol}

The documentation for Allegro \commonlisp{} contains a separate
document describing their protocol for environments in the spirit of
CLtL2.%
\footnote{https://franz.com/support/documentation/current/doc/environments.htm}
We summarize the differences between the Allegro implementation and
the CLtL2 protocol here.

\begin{itemize}
\item Information about blocks and tags have been added in the form of
  two new functions \texttt{block-information} and
  \texttt{tag-information}.
\item (say more)
\end{itemize}

\subsection{LispWorks}

\subsection{CLtL2 compatibility system}

cl-environments
