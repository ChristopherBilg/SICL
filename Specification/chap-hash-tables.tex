\chapter{Hash tables}

This module was written by Hayley Patton.

\section{Package}

The package for all symbols in this chapter is \texttt{sicl-hash-table}.

\section{Protocol}

Most of the standard functions on hash tables are implemented as
generic functions:

{\small\Defgeneric {hash-table-p} {hash-table}
}

{\small\Defgeneric {hash-table-count} {hash-table}
}

{\small\Defgeneric {hash-table-rehash-size} {hash-table}
}

{\small\Defgeneric {gethash} {key hash-table \optional default}
}

{\small\Defgeneric {(setf gethash)} {new-value key hash-table \optional default}
}

{\small\Defgeneric {hash-table-test} {hash-table}
}

{\small\Defgeneric {remhash} {key hash-table}
}

\section{Base class}

\Defclass {hash-table}

This class is the base class of all hash tables.  It is a subclass of
the class \texttt{standard-object}.

\section{Implementation}

\subsection{Hash table implemented as a list of entries}

\Defclass {list-hash-table}

This class is a subclass of the class \texttt{hash-table}.
It provides and implementation of the protocol where the entries are
stored as an association list where the key is the \texttt{car} of the
element in the list and the value is the \texttt{cdr} of the element
in the list.

{\small\Defmethod {gethash} {key (hash-table {\tt list-hash-table})
    \optional default}
}

This method calls the generic function \texttt{contents} with
\textit{hash-table} as an argument to obtain a list of entries of
\texttt{hash-table}.  It also calls the generic function
\texttt{hash-table-test} with \textit{hash-table} as an argument to
obtain a function to be used to compare the keys of the entries to
\texttt{key}.  It then calls the standard \commonlisp{} function
\texttt{assoc}, passing it \textit{key}, the list of entries, and the
test function as the value of the keyword argument \texttt{:test}.  If
the call returns a non-\texttt{nil} value (i.e. a valid entry), then
the method returns two values, the \texttt{cdr} of that entry and
\texttt{t}.  Otherwise, the method return \texttt{nil} and
\texttt{nil}.

\subsection{Hash table implemented as a vector of buckets}

\Defclass {bucket-hash-table}

This class is a subclass of \texttt{hash-table}.  The implementation
uses a vector of buckets.
